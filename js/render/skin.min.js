"use strict";!function(e){var t={showAxes:!1,showGrid:!1,autoResize:!1,controls:{enabled:!0,zoom:!0,rotate:!0,pan:!0},camera:{x:20,y:35,z:20},canvas:{width:void 0,height:void 0}};function n(n,i){console.log(i),console.log(n),this.element=i,this._element=i||e.document.body,this._animId=-1,this.options=Object.assign({},t,n),THREE.OrbitControls||(console.warn("OrbitControls not found. Disabling skin controls."),this.options.controls.enabled=!1),this._element.skinRender=this}n.prototype.render=function(t,n){var i=this,r=!1;function l(t,s){r=!0,t.needsUpdate=!0,s&&(s.needsUpdate=!0);var l=-1;32===t.image.height?l=0:64===t.image.height?l=1:console.error("Couldn't detect texture version. Invalid dimensions: "+t.image.width+"x"+t.image.height),console.log("Skin Texture Version: "+l),t.magFilter=THREE.NearestFilter,t.minFilter=THREE.NearestFilter,t.anisotropy=0,s&&(s.magFilter=THREE.NearestFilter,s.minFilter=THREE.NearestFilter,s.anisotropy=0);var h=new THREE.Scene;i._scene=h;var c=new THREE.PerspectiveCamera(75,(i.options.canvas.width||e.innerWidth)/(i.options.canvas.height||e.innerHeight),.1,1e3),p=new THREE.WebGLRenderer({alpha:!0,antialias:!0});if(i._renderer=p,p.setSize(i.options.canvas.width||e.innerWidth,i.options.canvas.height||e.innerHeight),p.setClearColor(0,0),i._element.appendChild(i._canvas=p.domElement),i.options.controls.enabled){var x=new THREE.OrbitControls(c,p.domElement);x.enableZoom=i.options.controls.zoom,x.enableRotate=i.options.controls.rotate,x.enablePan=i.options.controls.pan,x.target.set(0,18,0)}i.options.autoResize&&e.addEventListener("resize",function(){var t=i.element?i.element.offsetWidth:e.innerWidth,n=i.element?i.element.offsetHeight:e.innerHeight;i._resize(t,n)},!1),i._resize=function(e,t){c.aspect=e/t,c.updateProjectionMatrix(),p.setSize(e,t)},i.options.showAxes&&h.add(a(100)),i.options.showGrid&&h.add(new THREE.GridHelper(100,100)),console.log("Slim: "+w);var f=o(t,s,l,w);h.add(f),i.playerModel=f,c.position.x=i.options.camera.x,c.position.y=i.options.camera.y,c.position.z=i.options.camera.z,c.lookAt(new THREE.Vector3(0,18,0));var d=function(){i._animId=requestAnimationFrame(d),i.getElement().dispatchEvent(new CustomEvent("skinRender",{detail:{playerModel:f}})),p.render(h,c)};i._animate=d,d(),"function"==typeof n&&n()}i._skinImage=new Image,i._skinImage.crossOrigin="anonymous",i._capeImage=new Image,i._capeImage.crossOrigin="anonymous";var h=void 0!==t.capeUrl||void 0!==t.capeData||void 0!==t.mineskin,w=!1,c=!1,p=!1,x=new THREE.Texture,f=new THREE.Texture;if(x.image=i._skinImage,i._skinImage.onload=function(){if(i._skinImage){if(c=!0,console.log("Skin Image Loaded"),void 0===t.slim){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=i._skinImage.width,e.height=i._skinImage.height,n.drawImage(i._skinImage,0,0),console.log("Slim Detection:");for(var o=n.getImageData(46,52,1,12).data,a=n.getImageData(54,20,1,12).data,s=!0,d=3;d<48;d+=4){if(255===o[d]){s=!1;break}if(255===a[d]){s=!1;break}}console.log(s),s&&(w=!0)}!c||!p&&h||r||l(x,f)}},i._skinImage.onerror=function(e){console.warn("Skin Image Error"),console.warn(e)},console.log("Has Cape: "+h),h?(f.image=i._capeImage,i._capeImage.onload=function(){i._capeImage&&(p=!0,console.log("Cape Image Loaded"),p&&c&&(r||l(x,f)))},i._capeImage.onerror=function(e){console.warn("Cape Image Error"),console.warn(e),c&&(r||l(x))}):(f=null,i._capeImage=null),"string"==typeof t)0===t.indexOf("http")?i._skinImage.src=t:t.length<=16?s("https://skinrender.ga/nameToUuid.php?name="+t,function(e,n){if(e)return console.log(e);console.log(n),i._skinImage.src="https://crafatar.com/skins/"+(n.id?n.id:t)}):t.length<=36?image.src="https://crafatar.com/skins/"+t:i._skinImage.src=t;else{if("object"!=typeof t)throw new Error("Invalid texture value");t.url?i._skinImage.src=t.url:t.data?i._skinImage.src=t.data:t.username?s("https://skinrender.ga/nameToUuid.php?name="+t.username,function(e,n){if(e)return console.log(e);i._skinImage.src="https://crafatar.com/skins/"+(n.id?n.id:t.username)}):t.uuid?i._skinImage.src="https://crafatar.com/skins/"+t.uuid:t.mineskin&&(i._skinImage.src="https://api.mineskin.org/render/texture/"+t.mineskin),t.capeUrl?i._capeImage.src=t.capeUrl:t.capeData?i._capeImage.src=t.capeData:t.mineskin&&(i._capeImage.src="https://api.mineskin.org/render/texture/"+t.mineskin+"/cape"),w=t.slim}},n.prototype.resize=function(e,t){return this._resize(e,t)},n.prototype.reset=function(){this._skinImage=null,this._capeImage=null,this._animId&&cancelAnimationFrame(this._animId),this._canvas&&this._canvas.remove()},n.prototype.getElement=function(){return this._element},n.prototype.getPlayerModel=function(){return this.playerModel},n.prototype.getModelByName=function(e){return this._scene.getObjectByName(e,!0)},n.prototype.toggleSkinPart=function(e,t){this._scene.getObjectByName(e,!0).visible=t};var i=function(e,t,n,i,o,a,r,s){var l=e.image.width,h=e.image.height,w=new THREE.BoxGeometry(t,n,i),c=new THREE.MeshBasicMaterial({map:e,transparent:s||!1,side:s?THREE.DoubleSide:THREE.FrontSide});w.computeBoundingBox(),w.faceVertexUvs[0]=[];for(var p=["right","left","top","bottom","front","back"],x=[],f=0;f<p.length;f++){var d=o[p[f]],y=l,m=h,E=(a&&d.sx?d.sx:d.x)/y,g=d.y/m,u=((a&&d.sx?d.sx:d.x)+(a&&d.sw?d.sw:d.w))/y,v=(d.y+d.h)/m;x[f]=[new THREE.Vector2(E,v),new THREE.Vector2(E,g),new THREE.Vector2(u,g),new THREE.Vector2(u,v)];var T,R=d.flipX;d.flipY&&(T=x[f].slice(0),x[f][0]=T[2],x[f][1]=T[3],x[f][2]=T[0],x[f][3]=T[1]),R&&(T=x[f].slice(0),x[f][0]=T[3],x[f][1]=T[2],x[f][2]=T[1],x[f][3]=T[0])}var H=0;for(f=0;f<x.length;f++)w.faceVertexUvs[0][H]=[x[f][0],x[f][1],x[f][3]],w.faceVertexUvs[0][H+1]=[x[f][1],x[f][2],x[f][3]],H+=2;w.uvsNeedUpdate=!0;var b=new THREE.Mesh(w,c);return b.name=r,b.castShadow=!0,b.receiveShadow=!1,b},o=function(e,t,n,o){var a=new THREE.Object3D;a.position.x=0,a.position.y=28,a.position.z=0,a.translateOnAxis(new THREE.Vector3(0,1,0),-4);var r=i(e,8,8,8,l.head[n],o,"head");if(r.translateOnAxis(new THREE.Vector3(0,1,0),4),a.add(r),n>=1){var s=i(e,8.504,8.504,8.504,l.hat,o,"hat",!0);s.translateOnAxis(new THREE.Vector3(0,1,0),4),a.add(s)}var h=new THREE.Object3D;h.position.x=0,h.position.y=18,h.position.z=0;var w=i(e,8,12,4,l.body[n],o,"body");if(h.add(w),n>=1){var c=i(e,8.504,12.504,4.504,l.jacket,o,"jacket",!0);h.add(c)}var p=new THREE.Object3D;p.position.x=o?-5.5:-6,p.position.y=18,p.position.z=0,p.translateOnAxis(new THREE.Vector3(0,1,0),4);var x=i(e,o?3:4,12,4,l.leftArm[n],o,"leftArm");if(x.translateOnAxis(new THREE.Vector3(0,1,0),-4),p.add(x),n>=1){var f=i(e,o?3.504:4.504,12.504,4.504,l.leftSleeve,o,"leftSleeve",!0);f.translateOnAxis(new THREE.Vector3(0,1,0),-4),p.add(f)}var d=new THREE.Object3D;d.position.x=o?5.5:6,d.position.y=18,d.position.z=0,d.translateOnAxis(new THREE.Vector3(0,1,0),4);var y=i(e,o?3:4,12,4,l.rightArm[n],o,"rightArm");if(y.translateOnAxis(new THREE.Vector3(0,1,0),-4),d.add(y),n>=1){var m=i(e,o?3.504:4.504,12.504,4.504,l.rightSleeve,o,"rightSleeve",!0);m.translateOnAxis(new THREE.Vector3(0,1,0),-4),d.add(m)}var E=new THREE.Object3D;E.position.x=-2,E.position.y=6,E.position.z=0,E.translateOnAxis(new THREE.Vector3(0,1,0),4);var g=i(e,4,12,4,l.leftLeg[n],o,"leftLeg");if(g.translateOnAxis(new THREE.Vector3(0,1,0),-4),E.add(g),n>=1){var u=i(e,4.504,12.504,4.504,l.leftTrousers,o,"leftTrousers",!0);u.translateOnAxis(new THREE.Vector3(0,1,0),-4),E.add(u)}var v=new THREE.Object3D;v.position.x=2,v.position.y=6,v.position.z=0,v.translateOnAxis(new THREE.Vector3(0,1,0),4);var T=i(e,4,12,4,l.rightLeg[n],o,"rightLeg");if(T.translateOnAxis(new THREE.Vector3(0,1,0),-4),v.add(T),n>=1){var R=i(e,4.504,12.504,4.504,l.rightTrousers,o,"rightTrousers",!0);R.translateOnAxis(new THREE.Vector3(0,1,0),-4),v.add(R)}var H=new THREE.Object3D;if(H.add(a),H.add(h),H.add(p),H.add(d),H.add(E),H.add(v),t){var b=new THREE.Object3D;b.position.x=0,b.position.y=16,b.position.z=-2.5,b.translateOnAxis(new THREE.Vector3(0,1,0),8),b.translateOnAxis(new THREE.Vector3(0,0,1),.5);var k=i(t,8,16,1,l.cape,!1,"cape");k.translateOnAxis(new THREE.Vector3(0,1,0),-8),k.translateOnAxis(new THREE.Vector3(0,0,1),-.5),k.rotation.y=180*(Math.PI/180),b.add(k),H.add(b)}return H},a=function(e){var t=new THREE.Object3D;return t.add(r(new THREE.Vector3(0,0,0),new THREE.Vector3(e,0,0),16711680,!1)),t.add(r(new THREE.Vector3(0,0,0),new THREE.Vector3(-e,0,0),16711680,!0)),t.add(r(new THREE.Vector3(0,0,0),new THREE.Vector3(0,e,0),65280,!1)),t.add(r(new THREE.Vector3(0,0,0),new THREE.Vector3(0,-e,0),65280,!0)),t.add(r(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,e),255,!1)),t.add(r(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-e),255,!0)),t},r=function(e,t,n,i){var o,a=new THREE.Geometry;return o=i?new THREE.LineDashedMaterial({linewidth:3,color:n,dashSize:3,gapSize:3}):new THREE.LineBasicMaterial({linewidth:3,color:n}),a.vertices.push(e.clone()),a.vertices.push(t.clone()),a.computeLineDistances(),new THREE.Line(a,o,THREE.LinePieces)};function s(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="json",n.onload=function(){var e=n.status;t(200===e?null:n.statusText,n.response)},n.send()}var l={head:[{right:{x:0,y:16,w:8,h:8,flipX:!0},front:{x:8,y:16,w:8,h:8},left:{x:16,y:16,w:8,h:8,flipX:!0},back:{x:24,y:16,w:8,h:8},top:{x:8,y:24,w:8,h:8},bottom:{x:16,y:24,w:8,h:8,flipX:!0,flipY:!0}},{right:{x:0,y:48,w:8,h:8,flipX:!0},front:{x:8,y:48,w:8,h:8},left:{x:16,y:48,w:8,h:8,flipX:!0},back:{x:24,y:48,w:8,h:8},top:{x:8,y:56,w:8,h:8},bottom:{x:16,y:56,w:8,h:8,flipX:!0,flipY:!0}}],body:[{right:{x:16,y:0,w:4,h:12,flipX:!0},front:{x:20,y:0,w:8,h:12},left:{x:28,y:0,w:4,h:12,flipX:!0},back:{x:32,y:0,w:8,h:12},top:{x:20,y:12,w:8,h:4},bottom:{x:28,y:12,w:8,h:4,flipY:!0}},{right:{x:16,y:32,w:4,h:12,flipX:!0},front:{x:20,y:32,w:8,h:12},left:{x:28,y:32,w:4,h:12,flipX:!0},back:{x:32,y:32,w:8,h:12},top:{x:20,y:44,w:8,h:4},bottom:{x:28,y:44,w:8,h:4,flipY:!0}}],leftArm:[{right:{x:40,y:0,w:4,h:12,flipX:!0},front:{x:44,y:0,w:4,h:12,flipX:!0},left:{x:48,y:0,w:4,h:12,flipX:!0},back:{x:52,y:0,w:4,h:12,flipX:!0},top:{x:44,y:12,w:4,h:4,flipX:!0},bottom:{x:48,y:12,w:4,h:4,flipX:!0}},{right:{x:32,y:0,w:4,h:12,flipX:!0},front:{x:36,y:0,w:4,h:12,sw:3,flipX:!0},left:{x:40,y:0,w:4,h:12,sx:39,flipX:!0},back:{x:44,y:0,w:4,h:12,sx:43,sw:3,flipX:!0},top:{x:36,y:12,w:4,h:4,sw:3,flipX:!0},bottom:{x:40,y:12,w:4,h:4,sx:39,sw:3,flipX:!0}}],rightArm:[{right:{x:40,y:0,w:4,h:12,flipX:!0},front:{x:44,y:0,w:4,h:12,flipX:!0},left:{x:48,y:0,w:4,h:12,flipX:!0},back:{x:52,y:0,w:4,h:12,flipX:!0},top:{x:44,y:12,w:4,h:4,flipX:!0},bottom:{x:48,y:12,w:4,h:4,flipX:!0}},{right:{x:40,y:32,w:4,h:12,flipX:!0},front:{x:44,y:32,w:4,h:12,sw:3,flipX:!0},left:{x:48,y:32,w:4,h:12,sx:47,flipX:!0},back:{x:52,y:32,w:4,h:12,sx:51,sw:3,flipX:!0},top:{x:44,y:44,w:4,h:4,sw:3,flipX:!0},bottom:{x:48,y:44,w:4,h:4,sx:47,sw:3,flipX:!0}}],leftLeg:[{right:{x:0,y:0,w:4,h:12,flipX:!0},front:{x:4,y:0,w:4,h:12,flipX:!1},left:{x:8,y:0,w:4,h:12,flipX:!0},back:{x:12,y:0,w:4,h:12},top:{x:4,y:12,w:4,h:4,flipX:!0},bottom:{x:8,y:12,w:4,h:4,flipX:!0}},{right:{x:16,y:0,w:4,h:12,flipX:!0},front:{x:20,y:0,w:4,h:12,flipX:!0},left:{x:24,y:0,w:4,h:12,flipX:!0},back:{x:28,y:0,w:4,h:12,flipX:!0},top:{x:20,y:12,w:4,h:4,flipX:!0},bottom:{x:24,y:12,w:4,h:4,flipX:!0}}],rightLeg:[{right:{x:0,y:0,w:4,h:12,flipX:!0},front:{x:4,y:0,w:4,h:12,flipX:!0},left:{x:8,y:0,w:4,h:12,flipX:!0},back:{x:12,y:0,w:4,h:12,flipX:!0},top:{x:4,y:12,w:4,h:4,flipX:!0},bottom:{x:8,y:12,w:4,h:4,flipX:!0}},{right:{x:0,y:32,w:4,h:12,flipX:!0},front:{x:4,y:32,w:4,h:12,flipX:!0},left:{x:8,y:32,w:4,h:12,flipX:!0},back:{x:12,y:32,w:4,h:12,flipX:!0},top:{x:4,y:44,w:4,h:4,flipX:!0},bottom:{x:8,y:44,w:4,h:4,flipX:!0}}],hat:{right:{x:32,y:48,w:8,h:8,flipX:!0},front:{x:40,y:48,w:8,h:8},left:{x:48,y:48,w:8,h:8,flipX:!0},back:{x:56,y:48,w:8,h:8},top:{x:40,y:56,w:8,h:8},bottom:{x:48,y:56,w:8,h:8,flipY:!0}},jacket:{right:{x:16,y:16,w:4,h:12},front:{x:20,y:16,w:8,h:12},left:{x:26,y:16,w:4,h:12},back:{x:32,y:16,w:8,h:12},top:{x:20,y:28,w:8,h:4},bottom:{x:28,y:28,w:8,h:4}},leftSleeve:{right:{x:48,y:0,w:4,h:12},front:{x:52,y:0,w:4,h:12,sw:3},left:{x:56,y:0,w:4,h:12,sx:55},back:{x:60,y:0,w:4,h:12,sx:59,sw:3},top:{x:52,y:12,w:4,h:4,sw:3},bottom:{x:56,y:12,w:4,h:4,sx:55,sw:3}},rightSleeve:{right:{x:40,y:16,w:4,h:12},front:{x:44,y:16,w:4,h:12,sw:3},left:{x:48,y:16,w:4,h:12,sx:47},back:{x:52,y:16,w:4,h:12,sx:51,sw:3},top:{x:44,y:28,w:4,h:4,sw:3},bottom:{x:48,y:28,w:4,h:4,sx:47,sw:3}},leftTrousers:{right:{x:0,y:0,w:4,h:12},front:{x:4,y:0,w:4,h:12},left:{x:8,y:0,w:4,h:12},back:{x:12,y:0,w:4,h:12},top:{x:4,y:12,w:4,h:4},bottom:{x:8,y:12,w:4,h:4}},rightTrousers:{right:{x:0,y:16,w:4,h:12},front:{x:4,y:16,w:4,h:12},left:{x:8,y:16,w:4,h:12},back:{x:12,y:16,w:4,h:12},top:{x:4,y:28,w:4,h:4},bottom:{x:8,y:28,w:4,h:4}},cape:{right:{x:0,y:15,w:1,h:16},front:{x:1,y:15,w:10,h:16},left:{x:11,y:15,w:1,h:16},back:{x:12,y:15,w:10,h:16},top:{x:1,y:31,w:10,h:1},bottom:{x:11,y:31,w:10,h:1}}};e.SkinRender=n}(window);
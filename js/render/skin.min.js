"use strict";!function(m){var n={showAxes:!1,showGrid:!1,autoResize:!1,controls:{enabled:!0,zoom:!0,rotate:!0,pan:!0},camera:{x:20,y:35,z:20},canvas:{width:void 0,height:void 0}};function e(e,t){console.log(t),console.log(e),this.element=t,this._element=t||m.document.body,this._animId=-1,this.options=Object.assign({},n,e),THREE.OrbitControls||(console.warn("OrbitControls not found. Disabling skin controls."),this.options.controls.enabled=!1),this._element.skinRender=this}e.prototype.render=function(r,h){var w=this,c=!1;function s(e,t){c=!0,e.needsUpdate=!0,t&&(t.needsUpdate=!0);var n=-1;32===e.image.height?n=0:64===e.image.height?n=1:console.error("Couldn't detect texture version. Invalid dimensions: "+e.image.width+"x"+e.image.height),console.log("Skin Texture Version: "+n),e.magFilter=THREE.NearestFilter,e.minFilter=THREE.NearestFilter,e.anisotropy=0,t&&(t.magFilter=THREE.NearestFilter,t.minFilter=THREE.NearestFilter,t.anisotropy=0);var i=new THREE.Scene;w._scene=i;var o=new THREE.PerspectiveCamera(75,(w.options.canvas.width||m.innerWidth)/(w.options.canvas.height||m.innerHeight),.1,1e3),a=new THREE.WebGLRenderer({alpha:!0,antialias:!0});if((w._renderer=a).setSize(w.options.canvas.width||m.innerWidth,w.options.canvas.height||m.innerHeight),a.setClearColor(0,0),w._element.appendChild(w._canvas=a.domElement),w.options.controls.enabled){var r=new THREE.OrbitControls(o,a.domElement);r.enableZoom=w.options.controls.zoom,r.enableRotate=w.options.controls.rotate,r.enablePan=w.options.controls.pan,r.target.set(0,18,0)}w.options.autoResize&&m.addEventListener("resize",function(){var e=w.element?w.element.offsetWidth:m.innerWidth,t=w.element?w.element.offsetHeight:m.innerHeight;w._resize(e,t)},!1),w._resize=function(e,t){o.aspect=e/t,o.updateProjectionMatrix(),a.setSize(e,t)},w.options.showAxes&&i.add(g(100)),w.options.showGrid&&i.add(new THREE.GridHelper(100,100)),console.log("Slim: "+p);var s=E(e,t,n,p);i.add(s),w.playerModel=s,o.position.x=w.options.camera.x,o.position.y=w.options.camera.y,o.position.z=w.options.camera.z,o.lookAt(new THREE.Vector3(0,18,0));var l=function(){w._animId=requestAnimationFrame(l),w.getElement().dispatchEvent(new CustomEvent("skinRender",{detail:{playerModel:s}})),a.render(i,o)};(w._animate=l)(),"function"==typeof h&&h()}w._skinImage=new Image,w._skinImage.crossOrigin="anonymous",w._capeImage=new Image,w._capeImage.crossOrigin="anonymous";var l=void 0!==r.capeUrl||void 0!==r.capeData||void 0!==r.mineskin,p=!1,x=!1,f=!1,d=new THREE.Texture,y=new THREE.Texture;if(d.image=w._skinImage,w._skinImage.onload=function(){if(w._skinImage){if(x=!0,console.log("Skin Image Loaded"),void 0===r.slim){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=w._skinImage.width,e.height=w._skinImage.height,t.drawImage(w._skinImage,0,0),console.log("Slim Detection:");for(var n=t.getImageData(46,52,1,12).data,i=t.getImageData(54,20,1,12).data,o=!0,a=3;a<48;a+=4){if(255===n[a]){o=!1;break}if(255===i[a]){o=!1;break}}console.log(o),o&&(p=!0)}!x||!f&&l||c||s(d,y)}},w._skinImage.onerror=function(e){console.warn("Skin Image Error"),console.warn(e)},console.log("Has Cape: "+l),l?(y.image=w._capeImage,w._capeImage.onload=function(){w._capeImage&&(f=!0,console.log("Cape Image Loaded"),f&&x&&(c||s(d,y)))},w._capeImage.onerror=function(e){console.warn("Cape Image Error"),console.warn(e),f=!0,x&&(c||s(d))}):(y=null,w._capeImage=null),"string"==typeof r)0===r.indexOf("http")?w._skinImage.src=r:r.length<=16?t("https://skinrender.ga/nameToUuid.php?name="+r,function(e,t){if(e)return console.log(e);console.log(t),w._skinImage.src="https://crafatar.com/skins/"+(t.id?t.id:r)}):r.length<=36?image.src="https://crafatar.com/skins/"+r+"?overlay":w._skinImage.src=r;else{if("object"!=typeof r)throw new Error("Invalid texture value");r.url?w._skinImage.src=r.url:r.data?w._skinImage.src=r.data:r.username?t("https://skinrender.ga/nameToUuid.php?name="+r.username,function(e,t){if(e)return console.log(e);w._skinImage.src="https://crafatar.com/skins/"+(t.id?t.id:r.username)+"?overlay"}):r.uuid?w._skinImage.src="https://crafatar.com/skins/"+r.uuid+"?overlay":r.mineskin&&(w._skinImage.src="https://api.mineskin.org/render/texture/"+r.mineskin),r.capeUrl?w._capeImage.src=r.capeUrl:r.capeData?w._capeImage.src=r.capeData:r.mineskin&&(w._capeImage.src="https://api.mineskin.org/render/texture/"+r.mineskin+"/cape"),p=r.slim}},e.prototype.resize=function(e,t){return this._resize(e,t)},e.prototype.reset=function(){this._skinImage=null,this._capeImage=null,this._animId&&cancelAnimationFrame(this._animId),this._canvas&&this._canvas.remove()},e.prototype.getElement=function(){return this._element},e.prototype.getPlayerModel=function(){return this.playerModel},e.prototype.getModelByName=function(e){return this._scene.getObjectByName(e,!0)};var b=function(e,t,n,i,o,a,r,s){var l=e.image.width,h=e.image.height,w=new THREE.BoxGeometry(t,n,i),c=new THREE.MeshBasicMaterial({map:e,transparent:s||!1,side:s?THREE.DoubleSide:THREE.FrontSide});w.computeBoundingBox(),w.faceVertexUvs[0]=[];for(var p=["right","left","top","bottom","front","back"],x=[],f=0;f<p.length;f++){var d=o[p[f]],y=l,m=h,E=(a&&d.sx?d.sx:d.x)/y,g=d.y/m,u=((a&&d.sx?d.sx:d.x)+(a&&d.sw?d.sw:d.w))/y,v=(d.y+d.h)/m;x[f]=[new THREE.Vector2(E,v),new THREE.Vector2(E,g),new THREE.Vector2(u,g),new THREE.Vector2(u,v)];var T,R=d.flipX;d.flipY&&(T=x[f].slice(0),x[f][0]=T[2],x[f][1]=T[3],x[f][2]=T[0],x[f][3]=T[1]),R&&(T=x[f].slice(0),x[f][0]=T[3],x[f][1]=T[2],x[f][2]=T[1],x[f][3]=T[0])}var H=0;for(f=0;f<x.length;f++)w.faceVertexUvs[0][H]=[x[f][0],x[f][1],x[f][3]],w.faceVertexUvs[0][H+1]=[x[f][1],x[f][2],x[f][3]],H+=2;w.uvsNeedUpdate=!0;var b=new THREE.Mesh(w,c);return b.name=r,b.castShadow=!0,b.receiveShadow=!1,b},E=function(e,t,n,i){var o=new THREE.Object3D;o.position.x=0,o.position.y=28,o.position.z=0,o.translateOnAxis(new THREE.Vector3(0,1,0),-4);var a=b(e,8,8,8,k.head[n],i,"head");if(a.translateOnAxis(new THREE.Vector3(0,1,0),4),o.add(a),1<=n){var r=b(e,8.504,8.504,8.504,k.hat,i,"hat",!0);r.translateOnAxis(new THREE.Vector3(0,1,0),4),o.add(r)}var s=new THREE.Object3D;s.position.x=0,s.position.y=18,s.position.z=0;var l=b(e,8,12,4,k.body[n],i,"body");if(s.add(l),1<=n){var h=b(e,8.504,12.504,4.504,k.jacket,i,"jacket",!0);s.add(h)}var w=new THREE.Object3D;w.position.x=i?-5.5:-6,w.position.y=18,w.position.z=0,w.translateOnAxis(new THREE.Vector3(0,1,0),4);var c=b(e,i?3:4,12,4,k.leftArm[n],i,"leftArm");if(c.translateOnAxis(new THREE.Vector3(0,1,0),-4),w.add(c),1<=n){var p=b(e,i?3.504:4.504,12.504,4.504,k.leftSleeve,i,"leftSleeve",!0);p.translateOnAxis(new THREE.Vector3(0,1,0),-4),w.add(p)}var x=new THREE.Object3D;x.position.x=i?5.5:6,x.position.y=18,x.position.z=0,x.translateOnAxis(new THREE.Vector3(0,1,0),4);var f=b(e,i?3:4,12,4,k.rightArm[n],i,"rightArm");if(f.translateOnAxis(new THREE.Vector3(0,1,0),-4),x.add(f),1<=n){var d=b(e,i?3.504:4.504,12.504,4.504,k.rightSleeve,i,"rightSleeve",!0);d.translateOnAxis(new THREE.Vector3(0,1,0),-4),x.add(d)}var y=new THREE.Object3D;y.position.x=-2,y.position.y=6,y.position.z=0,y.translateOnAxis(new THREE.Vector3(0,1,0),4);var m=b(e,4,12,4,k.leftLeg[n],i,"leftLeg");if(m.translateOnAxis(new THREE.Vector3(0,1,0),-4),y.add(m),1<=n){var E=b(e,4.504,12.504,4.504,k.leftTrousers,i,"leftTrousers",!0);E.translateOnAxis(new THREE.Vector3(0,1,0),-4),y.add(E)}var g=new THREE.Object3D;g.position.x=2,g.position.y=6,g.position.z=0,g.translateOnAxis(new THREE.Vector3(0,1,0),4);var u=b(e,4,12,4,k.rightLeg[n],i,"rightLeg");if(u.translateOnAxis(new THREE.Vector3(0,1,0),-4),g.add(u),1<=n){var v=b(e,4.504,12.504,4.504,k.rightTrousers,i,"rightTrousers",!0);v.translateOnAxis(new THREE.Vector3(0,1,0),-4),g.add(v)}var T=new THREE.Object3D;if(T.add(o),T.add(s),T.add(w),T.add(x),T.add(y),T.add(g),t){var R=new THREE.Object3D;R.position.x=0,R.position.y=16,R.position.z=-2.5,R.translateOnAxis(new THREE.Vector3(0,1,0),8),R.translateOnAxis(new THREE.Vector3(0,0,1),.5);var H=b(t,8,16,1,k.cape,!1,"cape");H.translateOnAxis(new THREE.Vector3(0,1,0),-8),H.translateOnAxis(new THREE.Vector3(0,0,1),-.5),H.rotation.y=180*(Math.PI/180),R.add(H),T.add(R)}return T},g=function(e){var t=new THREE.Object3D;return t.add(i(new THREE.Vector3(0,0,0),new THREE.Vector3(e,0,0),16711680,!1)),t.add(i(new THREE.Vector3(0,0,0),new THREE.Vector3(-e,0,0),16711680,!0)),t.add(i(new THREE.Vector3(0,0,0),new THREE.Vector3(0,e,0),65280,!1)),t.add(i(new THREE.Vector3(0,0,0),new THREE.Vector3(0,-e,0),65280,!0)),t.add(i(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,e),255,!1)),t.add(i(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-e),255,!0)),t},i=function(e,t,n,i){var o,a=new THREE.Geometry;return o=i?new THREE.LineDashedMaterial({linewidth:3,color:n,dashSize:3,gapSize:3}):new THREE.LineBasicMaterial({linewidth:3,color:n}),a.vertices.push(e.clone()),a.vertices.push(t.clone()),a.computeLineDistances(),new THREE.Line(a,o,THREE.LinePieces)};function t(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="json",n.onload=function(){var e=n.status;t(200===e?null:n.statusText,n.response)},n.send()}var k={head:[{right:{x:0,y:16,w:8,h:8,flipX:!0},front:{x:8,y:16,w:8,h:8},left:{x:16,y:16,w:8,h:8,flipX:!0},back:{x:24,y:16,w:8,h:8},top:{x:8,y:24,w:8,h:8},bottom:{x:16,y:24,w:8,h:8,flipX:!0,flipY:!0}},{right:{x:0,y:48,w:8,h:8,flipX:!0},front:{x:8,y:48,w:8,h:8},left:{x:16,y:48,w:8,h:8,flipX:!0},back:{x:24,y:48,w:8,h:8},top:{x:8,y:56,w:8,h:8},bottom:{x:16,y:56,w:8,h:8,flipX:!0,flipY:!0}}],body:[{right:{x:16,y:0,w:4,h:12,flipX:!0},front:{x:20,y:0,w:8,h:12},left:{x:28,y:0,w:4,h:12,flipX:!0},back:{x:32,y:0,w:8,h:12},top:{x:20,y:12,w:8,h:4},bottom:{x:28,y:12,w:8,h:4,flipY:!0}},{right:{x:16,y:32,w:4,h:12,flipX:!0},front:{x:20,y:32,w:8,h:12},left:{x:28,y:32,w:4,h:12,flipX:!0},back:{x:32,y:32,w:8,h:12},top:{x:20,y:44,w:8,h:4},bottom:{x:28,y:44,w:8,h:4,flipY:!0}}],leftArm:[{right:{x:40,y:0,w:4,h:12,flipX:!0},front:{x:44,y:0,w:4,h:12,flipX:!0},left:{x:48,y:0,w:4,h:12,flipX:!0},back:{x:52,y:0,w:4,h:12,flipX:!0},top:{x:44,y:12,w:4,h:4,flipX:!0},bottom:{x:48,y:12,w:4,h:4,flipX:!0}},{right:{x:32,y:0,w:4,h:12,flipX:!0},front:{x:36,y:0,w:4,h:12,sw:3,flipX:!0},left:{x:40,y:0,w:4,h:12,sx:39,flipX:!0},back:{x:44,y:0,w:4,h:12,sx:43,sw:3,flipX:!0},top:{x:36,y:12,w:4,h:4,sw:3,flipX:!0},bottom:{x:40,y:12,w:4,h:4,sx:39,sw:3,flipX:!0}}],rightArm:[{right:{x:40,y:0,w:4,h:12,flipX:!0},front:{x:44,y:0,w:4,h:12,flipX:!0},left:{x:48,y:0,w:4,h:12,flipX:!0},back:{x:52,y:0,w:4,h:12,flipX:!0},top:{x:44,y:12,w:4,h:4,flipX:!0},bottom:{x:48,y:12,w:4,h:4,flipX:!0}},{right:{x:40,y:32,w:4,h:12,flipX:!0},front:{x:44,y:32,w:4,h:12,sw:3,flipX:!0},left:{x:48,y:32,w:4,h:12,sx:47,flipX:!0},back:{x:52,y:32,w:4,h:12,sx:51,sw:3,flipX:!0},top:{x:44,y:44,w:4,h:4,sw:3,flipX:!0},bottom:{x:48,y:44,w:4,h:4,sx:47,sw:3,flipX:!0}}],leftLeg:[{right:{x:0,y:0,w:4,h:12,flipX:!0},front:{x:4,y:0,w:4,h:12,flipX:!(e.prototype.toggleSkinPart=function(e,t){this._scene.getObjectByName(e,!0).visible=t})},left:{x:8,y:0,w:4,h:12,flipX:!0},back:{x:12,y:0,w:4,h:12},top:{x:4,y:12,w:4,h:4,flipX:!0},bottom:{x:8,y:12,w:4,h:4,flipX:!0}},{right:{x:16,y:0,w:4,h:12,flipX:!0},front:{x:20,y:0,w:4,h:12,flipX:!0},left:{x:24,y:0,w:4,h:12,flipX:!0},back:{x:28,y:0,w:4,h:12,flipX:!0},top:{x:20,y:12,w:4,h:4,flipX:!0},bottom:{x:24,y:12,w:4,h:4,flipX:!0}}],rightLeg:[{right:{x:0,y:0,w:4,h:12,flipX:!0},front:{x:4,y:0,w:4,h:12,flipX:!0},left:{x:8,y:0,w:4,h:12,flipX:!0},back:{x:12,y:0,w:4,h:12,flipX:!0},top:{x:4,y:12,w:4,h:4,flipX:!0},bottom:{x:8,y:12,w:4,h:4,flipX:!0}},{right:{x:0,y:32,w:4,h:12,flipX:!0},front:{x:4,y:32,w:4,h:12,flipX:!0},left:{x:8,y:32,w:4,h:12,flipX:!0},back:{x:12,y:32,w:4,h:12,flipX:!0},top:{x:4,y:44,w:4,h:4,flipX:!0},bottom:{x:8,y:44,w:4,h:4,flipX:!0}}],hat:{right:{x:32,y:48,w:8,h:8,flipX:!0},front:{x:40,y:48,w:8,h:8},left:{x:48,y:48,w:8,h:8,flipX:!0},back:{x:56,y:48,w:8,h:8},top:{x:40,y:56,w:8,h:8},bottom:{x:48,y:56,w:8,h:8,flipY:!0}},jacket:{right:{x:16,y:16,w:4,h:12},front:{x:20,y:16,w:8,h:12},left:{x:26,y:16,w:4,h:12},back:{x:32,y:16,w:8,h:12},top:{x:20,y:28,w:8,h:4},bottom:{x:28,y:28,w:8,h:4}},leftSleeve:{right:{x:48,y:0,w:4,h:12},front:{x:52,y:0,w:4,h:12,sw:3},left:{x:56,y:0,w:4,h:12,sx:55},back:{x:60,y:0,w:4,h:12,sx:59,sw:3},top:{x:52,y:12,w:4,h:4,sw:3},bottom:{x:56,y:12,w:4,h:4,sx:55,sw:3}},rightSleeve:{right:{x:40,y:16,w:4,h:12},front:{x:44,y:16,w:4,h:12,sw:3},left:{x:48,y:16,w:4,h:12,sx:47},back:{x:52,y:16,w:4,h:12,sx:51,sw:3},top:{x:44,y:28,w:4,h:4,sw:3},bottom:{x:48,y:28,w:4,h:4,sx:47,sw:3}},leftTrousers:{right:{x:0,y:0,w:4,h:12},front:{x:4,y:0,w:4,h:12},left:{x:8,y:0,w:4,h:12},back:{x:12,y:0,w:4,h:12},top:{x:4,y:12,w:4,h:4},bottom:{x:8,y:12,w:4,h:4}},rightTrousers:{right:{x:0,y:16,w:4,h:12},front:{x:4,y:16,w:4,h:12},left:{x:8,y:16,w:4,h:12},back:{x:12,y:16,w:4,h:12},top:{x:4,y:28,w:4,h:4},bottom:{x:8,y:28,w:4,h:4}},cape:{right:{x:0,y:15,w:1,h:16},front:{x:1,y:15,w:10,h:16},left:{x:11,y:15,w:1,h:16},back:{x:12,y:15,w:10,h:16},top:{x:1,y:31,w:10,h:1},bottom:{x:11,y:31,w:10,h:1}}};m.SkinRender=e}(window);
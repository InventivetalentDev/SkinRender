"use strict";!function(e){function t(t,n){console.log(n),console.log(t),this.element=n,this._element=n||e.document.body,this._animId=-1,this.options=Object.assign({},o,t),THREE.OrbitControls||(console.warn("OrbitControls not found. Disabling skin controls."),this.options.controls.enabled=!1),this._element.skinRender=this}var o={showAxes:!1,showGrid:!1,autoResize:!1,controls:{enabled:!0,zoom:!0,rotate:!0,pan:!0},camera:{x:20,y:35,z:20},canvas:{width:void 0,height:void 0}};t.prototype.render=function(t,o){function n(t,n){s=!0,t.needsUpdate=!0,n&&(n.needsUpdate=!0);var l=-1;32===t.image.height?l=0:64===t.image.height?l=1:console.error("Couldn't detect texture version. Invalid dimensions: "+t.image.width+"x"+t.image.height),console.log("Skin Texture Version: "+l),t.magFilter=THREE.NearestFilter,t.minFilter=THREE.LinearMipMapLinearFilter,n&&(n.magFilter=THREE.NearestFilter,n.minFilter=THREE.LinearMipMapLinearFilter);var h=new THREE.Scene;a._scene=h;var w=new THREE.PerspectiveCamera(75,(a.options.canvas.width||e.innerWidth)/(a.options.canvas.height||e.innerHeight),.1,1e3),p=new THREE.WebGLRenderer({alpha:!0,antialiasing:!0});if(p.setSize(a.options.canvas.width||e.innerWidth,a.options.canvas.height||e.innerHeight),p.setClearColor(0,0),a._element.appendChild(a._canvas=p.domElement),a.options.controls.enabled){var x=new THREE.OrbitControls(w,p.domElement);x.enableZoom=a.options.controls.zoom,x.enableRotate=a.options.controls.rotate,x.enablePan=a.options.controls.pan,x.target.set(0,18,0)}a.options.autoResize&&e.addEventListener("resize",function(){var t=a.element?a.element.offsetWidth:e.innerWidth,o=a.element?a.element.offsetHeight:e.innerHeight;a._resize(t,o)},!1),a._resize=function(e,t){w.aspect=e/t,w.updateProjectionMatrix(),p.setSize(e,t)},a.options.showAxes&&h.add(r(100)),a.options.showGrid&&h.add(new THREE.GridHelper(100,100)),console.log("Slim: "+c);var f=i(t,n,l,c);h.add(f),console.log(f),a.playerModel=f,w.position.x=a.options.camera.x,w.position.y=a.options.camera.y,w.position.z=a.options.camera.z,w.lookAt(new THREE.Vector3(0,18,0));var y=function(){a._animId=requestAnimationFrame(y),a.getElement().dispatchEvent(new CustomEvent("skinRender",{detail:{playerModel:f}})),p.render(h,w)};y(),"function"==typeof o&&o()}var a=this,s=!1,l=new Image;l.crossOrigin="anonymous";var h=new Image;h.crossOrigin="anonymous";var w=void 0!==t.capeUrl||void 0!==t.capeData,c=!1,p=!1,x=!1,f=new THREE.Texture,y=new THREE.Texture;if(f.image=l,l.onload=function(){if(p=!0,console.log("Skin Image Loaded"),void 0===t.slim){var e=document.createElement("canvas"),o=e.getContext("2d");e.width=l.width,e.height=l.height,o.drawImage(l,0,0),console.log("Slim Detection:");var i=o.getImageData(46,52,1,12).data;console.log(i);var r=o.getImageData(54,20,1,12).data;console.log(r);for(var a=!0,h=3;48>h;h+=4){if(255===i[h]){a=!1;break}if(255===r[h]){a=!1;break}}console.log(a),a&&(c=!0)}!p||!x&&w||s||n(f,y)},l.onerror=function(e){console.warn("Skin Image Error"),console.warn(e)},console.log("Has Cape: "+w),w?(y.image=h,h.onload=function(){x=!0,console.log("Cape Image Loaded"),x&&p&&(s||n(f,y))},h.onerror=function(e){console.warn("Cape Image Error"),console.warn(e)}):(y=null,h=null),"string"==typeof t)0===t.indexOf("http")?l.src=t:t.length<=16?l.src="https://crafatar.com/skins/"+t:l.src=t;else{if("object"!=typeof t)throw new Error("Invalid texture value");t.url?l.src=t.url:t.data?l.src=t.data:t.username?l.src="https://crafatar.com/skins/"+t.username:t.mineskin&&(l.src="https://api.mineskin.org/render/texture/"+t.mineskin),t.capeUrl?h.src=t.capeUrl:t.capeData&&(h.src=t.capeData),c=t.slim}},t.prototype.resize=function(e,t){return this._resize(e,t)},t.prototype.reset=function(){this._animId&&cancelAnimationFrame(this._animId),this._canvas&&this._canvas.remove()},t.prototype.getElement=function(){return this._element},t.prototype.getPlayerModel=function(){return this.playerModel},t.prototype.getModelByName=function(e){return this._scene.getObjectByName(e,!0)},t.prototype.toggleSkinPart=function(e,t){this._scene.getObjectByName(e,!0).visible=t};var n=function(e,t,o,n,i,r,a,s){var l=e.image.width,h=e.image.height,w=new THREE.BoxGeometry(t,o,n),c=new THREE.MeshBasicMaterial({map:e,transparent:s,side:THREE.DoubleSide});w.computeBoundingBox(),w.faceVertexUvs[0]=[];for(var p=["right","left","top","bottom","front","back"],x=[],f=0;f<p.length;f++){var y=i[p[f]];"back"===p[f]&&(console.log("X: "+(r&&y.sx?y.sx:y.x)),console.log("W: "+(r&&y.sw?y.sw:y.w)));var d=l,E=h,g=(r&&y.sx?y.sx:y.x)/d,m=y.y/E,v=((r&&y.sx?y.sx:y.x)+(r&&y.sw?y.sw:y.w))/d,T=(y.y+y.h)/E;x[f]=[new THREE.Vector2(g,T),new THREE.Vector2(g,m),new THREE.Vector2(v,m),new THREE.Vector2(v,T)];var R,b=y.flipX,H=y.flipY;H&&(R=x[f].slice(0),x[f][0]=R[2],x[f][1]=R[3],x[f][2]=R[0],x[f][3]=R[1]),b&&(R=x[f].slice(0),x[f][0]=R[3],x[f][1]=R[2],x[f][2]=R[1],x[f][3]=R[0])}for(var u=0,f=0;f<x.length;f++)w.faceVertexUvs[0][u]=[x[f][0],x[f][1],x[f][3]],w.faceVertexUvs[0][u+1]=[x[f][1],x[f][2],x[f][3]],u+=2;w.uvsNeedUpdate=!0;var X=new THREE.Mesh(w,c);return X.name=a,X.castShadow=!0,X.receiveShadow=!1,X},i=function(e,t,o,i){var r=new THREE.Object3D;r.position.x=0,r.position.y=28,r.position.z=0,r.translateOnAxis(new THREE.Vector3(0,1,0),-4);var a=n(e,8,8,8,s.head[o],i,"head");if(a.translateOnAxis(new THREE.Vector3(0,1,0),4),r.add(a),o>=1){var l=n(e,8.504,8.504,8.504,s.hat,i,"hat",!0);l.translateOnAxis(new THREE.Vector3(0,1,0),4),r.add(l)}var h=new THREE.Object3D;h.position.x=0,h.position.y=18,h.position.z=0;var w=n(e,8,12,4,s.body[o],i,"body");if(h.add(w),o>=1){var c=n(e,8.504,12.504,4.504,s.jacket,i,"jacket",!0);h.add(c)}var p=new THREE.Object3D;p.position.x=i?-5.5:-6,p.position.y=18,p.position.z=0,p.translateOnAxis(new THREE.Vector3(0,1,0),4);var x=n(e,i?3:4,12,4,s.leftArm[o],i,"leftArm");if(x.translateOnAxis(new THREE.Vector3(0,1,0),-4),p.add(x),o>=1){var f=n(e,i?3.504:4.504,12.504,4.504,s.leftSleeve,i,"leftSleeve",!0);f.translateOnAxis(new THREE.Vector3(0,1,0),-4),p.add(f)}var y=new THREE.Object3D;y.position.x=i?5.5:6,y.position.y=18,y.position.z=0,y.translateOnAxis(new THREE.Vector3(0,1,0),4);var d=n(e,i?3:4,12,4,s.rightArm[o],i,"rightArm");if(d.translateOnAxis(new THREE.Vector3(0,1,0),-4),y.add(d),o>=1){var E=n(e,i?3.504:4.504,12.504,4.504,s.rightSleeve,i,"rightSleeve",!0);E.translateOnAxis(new THREE.Vector3(0,1,0),-4),y.add(E)}var g=new THREE.Object3D;g.position.x=-2,g.position.y=6,g.position.z=0,g.translateOnAxis(new THREE.Vector3(0,1,0),4);var m=n(e,4,12,4,s.leftLeg[o],i,"leftLeg");if(m.translateOnAxis(new THREE.Vector3(0,1,0),-4),g.add(m),o>=1){var v=n(e,4.504,12.504,4.504,s.leftTrousers,i,"leftTrousers",!0);v.translateOnAxis(new THREE.Vector3(0,1,0),-4),g.add(v)}var T=new THREE.Object3D;T.position.x=2,T.position.y=6,T.position.z=0,T.translateOnAxis(new THREE.Vector3(0,1,0),4);var R=n(e,4,12,4,s.rightLeg[o],i,"rightLeg");if(R.translateOnAxis(new THREE.Vector3(0,1,0),-4),T.add(R),o>=1){var b=n(e,4.504,12.504,4.504,s.rightTrousers,i,"rightTrousers",!0);b.translateOnAxis(new THREE.Vector3(0,1,0),-4),T.add(b)}var H=new THREE.Object3D;if(H.add(r),H.add(h),H.add(p),H.add(y),H.add(g),H.add(T),t){var u=new THREE.Object3D;u.position.x=0,u.position.y=16,u.position.z=-2.5,u.translateOnAxis(new THREE.Vector3(0,1,0),8),u.translateOnAxis(new THREE.Vector3(0,0,1),.5);var X=n(t,8,16,1,s.cape,!1,"cape");X.translateOnAxis(new THREE.Vector3(0,1,0),-8),X.translateOnAxis(new THREE.Vector3(0,0,1),-.5),X.rotation.y=toRadians(180),u.add(X),H.add(u)}return H},r=function(e){var t=new THREE.Object3D;return t.add(a(new THREE.Vector3(0,0,0),new THREE.Vector3(e,0,0),16711680,!1)),t.add(a(new THREE.Vector3(0,0,0),new THREE.Vector3(-e,0,0),16711680,!0)),t.add(a(new THREE.Vector3(0,0,0),new THREE.Vector3(0,e,0),65280,!1)),t.add(a(new THREE.Vector3(0,0,0),new THREE.Vector3(0,-e,0),65280,!0)),t.add(a(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,e),255,!1)),t.add(a(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-e),255,!0)),t},a=function(e,t,o,n){var i,r=new THREE.Geometry;return i=n?new THREE.LineDashedMaterial({linewidth:3,color:o,dashSize:3,gapSize:3}):new THREE.LineBasicMaterial({linewidth:3,color:o}),r.vertices.push(e.clone()),r.vertices.push(t.clone()),r.computeLineDistances(),new THREE.Line(r,i,THREE.LinePieces)},s={head:[{right:{x:0,y:16,w:8,h:8,flipX:!0},front:{x:8,y:16,w:8,h:8},left:{x:16,y:16,w:8,h:8,flipX:!0},back:{x:24,y:16,w:8,h:8},top:{x:8,y:24,w:8,h:8},bottom:{x:16,y:24,w:8,h:8,flipX:!0,flipY:!0}},{right:{x:0,y:48,w:8,h:8,flipX:!0},front:{x:8,y:48,w:8,h:8},left:{x:16,y:48,w:8,h:8,flipX:!0},back:{x:24,y:48,w:8,h:8},top:{x:8,y:56,w:8,h:8},bottom:{x:16,y:56,w:8,h:8,flipX:!0,flipY:!0}}],body:[{right:{x:16,y:0,w:4,h:12,flipX:!0},front:{x:20,y:0,w:8,h:12},left:{x:28,y:0,w:4,h:12,flipX:!0},back:{x:32,y:0,w:8,h:12},top:{x:20,y:12,w:8,h:4},bottom:{x:28,y:12,w:8,h:4,flipY:!0}},{right:{x:16,y:32,w:4,h:12,flipX:!0},front:{x:20,y:32,w:8,h:12},left:{x:28,y:32,w:4,h:12,flipX:!0},back:{x:32,y:32,w:8,h:12},top:{x:20,y:44,w:8,h:4},bottom:{x:28,y:44,w:8,h:4,flipY:!0}}],leftArm:[{right:{x:40,y:0,w:4,h:12,flipX:!0},front:{x:44,y:0,w:4,h:12,flipX:!0},left:{x:48,y:0,w:4,h:12,flipX:!0},back:{x:52,y:0,w:4,h:12,flipX:!0},top:{x:44,y:12,w:4,h:4,flipX:!0},bottom:{x:48,y:12,w:4,h:4,flipX:!0}},{right:{x:32,y:0,w:4,h:12,flipX:!0},front:{x:36,y:0,w:4,h:12,sw:3,flipX:!0},left:{x:40,y:0,w:4,h:12,sx:39,flipX:!0},back:{x:44,y:0,w:4,h:12,sx:43,sw:3,flipX:!0},top:{x:36,y:12,w:4,h:4,sw:3,flipX:!0},bottom:{x:40,y:12,w:4,h:4,sx:39,sw:3,flipX:!0}}],rightArm:[{right:{x:40,y:0,w:4,h:12,flipX:!0},front:{x:44,y:0,w:4,h:12,flipX:!0},left:{x:48,y:0,w:4,h:12,flipX:!0},back:{x:52,y:0,w:4,h:12,flipX:!0},top:{x:44,y:12,w:4,h:4,flipX:!0},bottom:{x:48,y:12,w:4,h:4,flipX:!0}},{right:{x:40,y:32,w:4,h:12,flipX:!0},front:{x:44,y:32,w:4,h:12,sw:3,flipX:!0},left:{x:48,y:32,w:4,h:12,sx:47,flipX:!0},back:{x:52,y:32,w:4,h:12,sx:51,sw:3,flipX:!0},top:{x:44,y:44,w:4,h:4,sw:3,flipX:!0},bottom:{x:48,y:44,w:4,h:4,sx:47,sw:3,flipX:!0}}],leftLeg:[{right:{x:0,y:0,w:4,h:12,flipX:!0},front:{x:4,y:0,w:4,h:12,flipX:!1},left:{x:8,y:0,w:4,h:12,flipX:!0},back:{x:12,y:0,w:4,h:12,flipX:!0},top:{x:4,y:12,w:4,h:4,flipX:!0},bottom:{x:8,y:12,w:4,h:4,flipX:!0}},{right:{x:16,y:0,w:4,h:12,flipX:!0},front:{x:20,y:0,w:4,h:12,flipX:!0},left:{x:24,y:0,w:4,h:12,flipX:!0},back:{x:28,y:0,w:4,h:12,flipX:!0},top:{x:20,y:12,w:4,h:4,flipX:!0},bottom:{x:24,y:12,w:4,h:4,flipX:!0}}],rightLeg:[{right:{x:0,y:0,w:4,h:12,flipX:!0},front:{x:4,y:0,w:4,h:12,flipX:!0},left:{x:8,y:0,w:4,h:12,flipX:!0},back:{x:12,y:0,w:4,h:12,flipX:!0},top:{x:4,y:12,w:4,h:4,flipX:!0},bottom:{x:8,y:12,w:4,h:4,flipX:!0}},{right:{x:0,y:32,w:4,h:12,flipX:!0},front:{x:4,y:32,w:4,h:12,flipX:!0},left:{x:8,y:32,w:4,h:12,flipX:!0},back:{x:12,y:32,w:4,h:12,flipX:!0},top:{x:4,y:44,w:4,h:4,flipX:!0},bottom:{x:8,y:44,w:4,h:4,flipX:!0}}],hat:{right:{x:32,y:48,w:8,h:8,flipX:!0},front:{x:40,y:48,w:8,h:8},left:{x:48,y:48,w:8,h:8,flipX:!0},back:{x:56,y:48,w:8,h:8},top:{x:40,y:56,w:8,h:8},bottom:{x:48,y:56,w:8,h:8,flipY:!0}},jacket:{right:{x:16,y:16,w:4,h:12},front:{x:20,y:16,w:8,h:12},left:{x:26,y:16,w:4,h:12},back:{x:32,y:16,w:8,h:12},top:{x:20,y:28,w:8,h:4},bottom:{x:28,y:28,w:8,h:4}},leftSleeve:{right:{x:48,y:0,w:4,h:12},front:{x:52,y:0,w:4,h:12,sw:3},left:{x:56,y:0,w:4,h:12,sx:55},back:{x:60,y:0,w:4,h:12,sx:59,sw:3},top:{x:52,y:12,w:4,h:4,sw:3},bottom:{x:56,y:12,w:4,h:4,sx:55,sw:3}},rightSleeve:{right:{x:40,y:16,w:4,h:12},front:{x:44,y:16,w:4,h:12,sw:3},left:{x:48,y:16,w:4,h:12,sx:47},back:{x:52,y:16,w:4,h:12,sx:51,sw:3},top:{x:44,y:28,w:4,h:4,sw:3},bottom:{x:48,y:28,w:4,h:4,sx:47,sw:3}},leftTrousers:{right:{x:0,y:0,w:4,h:12},front:{x:4,y:0,w:4,h:12},left:{x:8,y:0,w:4,h:12},back:{x:12,y:0,w:4,h:12},top:{x:4,y:12,w:4,h:4},bottom:{x:8,y:12,w:4,h:4}},rightTrousers:{right:{x:0,y:16,w:4,h:12},front:{x:4,y:16,w:4,h:12},left:{x:8,y:16,w:4,h:12},back:{x:12,y:16,w:4,h:12},top:{x:4,y:28,w:4,h:4},bottom:{x:8,y:28,w:4,h:4}},cape:{right:{x:0,y:15,w:1,h:16},front:{x:1,y:15,w:10,h:16},left:{x:11,y:15,w:1,h:16},back:{x:12,y:15,w:10,h:16},top:{x:1,y:31,w:10,h:1},bottom:{x:11,y:31,w:10,h:1}}};e.SkinRender=t}(window);